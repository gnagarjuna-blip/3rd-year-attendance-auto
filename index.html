<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Faculty Attendance Pro - Enhanced</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0056b3;
            --present: #198754;
            --absent: #dc3545;
        }
        body { background-color: #f0f2f5; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        
        /* Dashboard Header */
        .sticky-header { 
            position: sticky; top: 0; background: linear-gradient(135deg, #0056b3, #003d7a); 
            z-index: 1000; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            color: white; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 12px;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(5px);
            padding: 8px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .stat-val { font-size: 1.2rem; font-weight: 800; display: block; }
        .stat-lbl { font-size: 0.65rem; text-transform: uppercase; opacity: 0.9; }

        /* Student List UI */
        .roll-card { 
            background: white; margin-bottom: 10px; border-radius: 12px; 
            padding: 12px; display: flex; justify-content: space-between; 
            align-items: center; border-left: 5px solid #ccc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .marked-present { border-left-color: var(--present); background: #f0fff4; }
        .marked-absent { border-left-color: var(--absent); background: #fff5f5; }
        
        .boy-text { color: #004085; font-weight: 600; }
        .girl-text { color: #b02a37; font-weight: 600; }

        .btn-attendance { width: 50px; border-radius: 8px; font-weight: bold; }
        
        .btn-post {
            background: #25D366; color: white; border: none;
            padding: 8px 20px; border-radius: 20px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="container p-0">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h6 class="mb-0 fw-bold">C/IC G.NAGARJUNA</h6>
                <div id="current-day-display" style="font-size: 0.75rem; opacity: 0.8;"></div>
            </div>
            <button class="btn-post" onclick="sendToWhatsApp()">ðŸ“¤ POST REPORT</button>
        </div>

        <div class="row g-2 mt-2">
            <div class="col-4">
                <select id="period-sel" class="form-select form-select-sm" onchange="syncClassInfo()">
                    <option value="0">P-I (9:20)</option>
                    <option value="1">P-II (10:10)</option>
                    <option value="2">P-III (11:10)</option>
                    <option value="3">P-IV (12:00)</option>
                    <option value="4">P-V (1:30)</option>
                    <option value="5">P-VI (2:20)</option>
                    <option value="6">P-VII (3:10)</option>
                </select>
            </div>
            <div class="col-8">
                <div id="class-info-display" class="form-control form-control-sm bg-light fw-bold text-truncate" style="font-size: 0.75rem;">Loading...</div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <span class="stat-val">32</span>
                <span class="stat-lbl">Total</span>
            </div>
            <div class="stat-card" style="background: rgba(40, 167, 69, 0.3);">
                <span id="p-count" class="stat-val">32</span>
                <span class="stat-lbl">Present</span>
            </div>
            <div class="stat-card" style="background: rgba(220, 53, 69, 0.3);">
                <span id="a-count" class="stat-val">0</span>
                <span class="stat-lbl">Absent</span>
            </div>
        </div>
    </div>
</div>

<div class="container mt-3 pb-5">
    <div id="student-list"></div>
</div>

<script>
    const students = [
        { r: "23E11A0201", n: "BASIUDEM ARJUN REDDY", g: "B" },
        { r: "23E11A0202", n: "K RAJKUMAR", g: "B" },
        { r: "23E11A0204", n: "KUTHATI DHANYA", g: "G" },
        { r: "23E11A0205", n: "PANTAHNGI NAVYA", g: "G" },
        { r: "23E11A0207", n: "KUNTIGORLA RAKESH", g: "B" },
        { r: "24E15A0201", n: "A VAISHNAVI", g: "G" },
        { r: "24E15A0202", n: "A.RAKESH VERMA", g: "B" },
        { r: "24E15A0203", n: "ALIVELI KARTHIK KUMAR", g: "B" },
        { r: "24E15A0204", n: "B.HARSHITHA", g: "G" },
        { r: "24E15A0205", n: "BODRAMANI SAI KIRAN", g: "B" },
        { r: "24E15A0206", n: "D BHARATHCHANDRA", g: "B" },
        { r: "24E15A0207", n: "D.SHAILAJA", g: "G" },
        { r: "24E15A0208", n: "DEVASATH RISHI KUMAR", g: "B" },
        { r: "24E15A0209", n: "G.SAI KUMAR", g: "B" },
        { r: "24E15A0210", n: "GUGULOTHU SAI KUMAR", g: "B" },
        { r: "24E15A0212", n: "KONDURU NITHIN", g: "B" },
        { r: "24E15A0213", n: "M BHASKAR", g: "B" },
        { r: "24E15A0214", n: "M GANESH", g: "B" },
        { r: "24E15A0215", n: "M.GOWTHAMI", g: "G" },
        { r: "24E15A0216", n: "MANDRA SHIVAMANI", g: "B" },
        { r: "24E15A0217", n: "MARAM AJAY", g: "B" },
        { r: "24E15A0218", n: "N MUKESH", g: "B" },
        { r: "24E15A0219", n: "O.GAMANA", g: "G" },
        { r: "24E15A0220", n: "P.VARSHA", g: "G" },
        { r: "24E15A0221", n: "R SPROOTHIKA", g: "G" },
        { r: "24E15A0222", n: "RAMAVATH SAIRAM", g: "B" },
        { r: "24E15A0223", n: "RATHOD SHRUTHI", g: "G" },
        { r: "24E15A0224", n: "SNEHA TAANK", g: "G" },
        { r: "24E15A0225", n: "THUMMALA SAI KUMAR", g: "B" },
        { r: "24E15A0226", n: "VADLA SAI KRISHNA", g: "B" },
        { r: "24E15A0227", n: "VALLAPU KARTHIK YADAV", g: "B" },
        { r: "24E15A0228", n: "V CHAKRAVARTHI VARMA", g: "B" }
    ];

    const facultyMap = {
        'FIOT': 'Mr. Praburaja Ramasamy', 'WSES': 'Mr. G. Nagarjuna', 'DSP': 'Mr. Muzammil Mushtaq',
        'PSP': 'Mrs. K Vani', 'PSOC': 'Dr. Praveen Tiwari', 'Power System Laboratory': 'Dr. H.W Pandey',
        'ES': 'Mrs. D. Swathi Devi', 'Aptitude': 'Training Cell'
    };

    const timetable = {
        'MON': ['WSES', 'DSP', 'PSP', 'PSOC', 'FIOT', 'Aptitude', 'Bridge Class'],
        'TUE': ['PSP', 'WSES', 'FIOT', 'DSP', 'Mini Project', 'Mini Project', 'Bridge Class'],
        'WED': ['FIOT', 'WSES', 'DSP', 'PSOC', 'Mini Project', 'Mini Project', 'Remedial Class'],
        'THU': ['PSOC', 'PSP', 'CS Lab', 'CS Lab', 'ES', 'HRT', 'Remedial Class'],
        'FRI': ['PSOC', 'DSP', 'DSP Lab', 'DSP Lab', 'ES', 'WSES', 'Remedial Class'],
        'SAT': ['FIOT', 'PSP', 'PS Lab', 'PS Lab', 'ES', 'Comm skills', 'Gate Class']
    };

    let attendance = {};

    function init() {
        const listDiv = document.getElementById('student-list');
        students.forEach(s => {
            attendance[s.r] = 'P';
            const colorClass = s.g === 'B' ? 'boy-text' : 'girl-text';
            const div = document.createElement('div');
            div.className = 'roll-card marked-present';
            div.id = `card-${s.r}`;
            div.innerHTML = `
                <div>
                    <div class="${colorClass}" style="font-size: 0.9rem;">${s.r}</div>
                    <div class="text-muted" style="font-size: 0.75rem;">${s.n}</div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-success btn-attendance" onclick="mark('${s.r}','P')">P</button>
                    <button class="btn btn-outline-danger btn-attendance" onclick="mark('${s.r}','A')">A</button>
                </div>
            `;
            listDiv.appendChild(div);
        });
        syncClassInfo();
    }

    function mark(roll, status) {
        attendance[roll] = status;
        const card = document.getElementById(`card-${roll}`);
        const btns = card.querySelectorAll('button');
        card.classList.toggle('marked-present', status === 'P');
        card.classList.toggle('marked-absent', status === 'A');
        btns[0].className = status === 'P' ? 'btn btn-success btn-attendance' : 'btn btn-outline-success btn-attendance';
        btns[1].className = status === 'A' ? 'btn btn-danger btn-attendance' : 'btn btn-outline-danger btn-attendance';
        updateStats();
    }

    function updateStats() {
        const abs = Object.values(attendance).filter(v => v === 'A').length;
        document.getElementById('a-count').innerText = abs;
        document.getElementById('p-count').innerText = students.length - abs;
    }

    function syncClassInfo() {
        const d = ['SUN','MON','TUE','WED','THU','FRI','SAT'][new Date().getDay()];
        const p = document.getElementById('period-sel').value;
        const sub = (timetable[d]) ? timetable[d][p] : "Special Class";
        const fac = facultyMap[sub] || "Assigned Faculty";
        document.getElementById('class-info-display').innerText = `${sub} - ${fac}`;
        document.getElementById('current-day-display').innerText = `${d}, ${new Date().toLocaleDateString()}`;
    }

    function sendToWhatsApp() {
        const info = document.getElementById('class-info-display').innerText;
        const period = document.getElementById('period-sel').options[document.getElementById('period-sel').selectedIndex].text;
        const absList = Object.keys(attendance).filter(k => attendance[k] === 'A').sort();
        const pCount = students.length - absList.length;
        const aCount = absList.length;
        
        const dateStr = new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });

        let msg = `*â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—*\n`;
        msg += `*â•‘   ðŸ“Š ATTENDANCE REPORT   â•‘*\n`;
        msg += `*â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•*\n\n`;
        
        msg += `*ðŸ“… Date:* ${dateStr}\n`;
        msg += `*â° Period:* ${period}\n`;
        msg += `*ðŸ“˜ Subject:* ${info}\n`;
        msg += `*ðŸ‘¤ Class I/C:* G. NAGARJUNA\n`;
        msg += `\n*â”€â”€â”€ SUMMARY STATS â”€â”€â”€*\n`;
       msg += `*âœ… P:* ${pCount}  |  *âŒ A:* ${aCount}\n`;
        msg += `\n*â”€â”€â”€ ABSENT LIST ðŸ”´ â”€â”€â”€*\n`;
        
        if(absList.length > 0) {
            let formatted = absList.reduce((acc, curr, i) => {
    return acc + curr.toString().padEnd(8) + ((i + 1) % 3 === 0 ? "\n" : "");
}, "");

msg += "```\n" + formatted.trim() + "\n```";
        } else {
            msg += `*ALL PRESENT (NIL)*`;
        }
        
        msg += `\n\n*Report Generated Successfully* âœ…`;

        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    init();
</script>
</body>
</html>
