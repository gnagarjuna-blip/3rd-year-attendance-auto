<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Faculty Attendance Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .sticky-header { position: sticky; top: 0; background: white; z-index: 1000; border-bottom: 5px solid #0056b3; padding: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Gender Colors */
        .boy-text { color: #0056b3; } /* Deep Blue for Boys */
        .girl-text { color: #d63384; } /* Pink/Magenta for Girls */
        
        .roll-card { background: white; margin-bottom: 8px; border-radius: 12px; padding: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 6px solid #adb5bd; transition: 0.2s; }
        
        .marked-present { border-left-color: #198754; background: #e9f7ef; }
        .marked-absent { border-left-color: #dc3545; background: #fdf2f2; }
        
        .stats-badge { font-size: 0.85rem; padding: 8px; border-radius: 8px; font-weight: bold; flex: 1; text-align: center; }
        .btn-attendance { width: 55px; font-weight: bold; border-radius: 10px !important; }
        .diff-box { background: #fff3cd; border: 1px dashed #ffc107; padding: 8px; font-size: 0.8rem; margin-top: 10px; border-radius: 8px; display: none; }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="container p-0">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <h6 class="mb-0 fw-bold text-dark">G.NAGARJUNA (CLASS INCHARGE)</h6>
                <small class="text-muted" id="current-day-display"></small>
            </div>
            <button class="btn btn-success btn-sm fw-bold px-3 shadow-sm" onclick="sendToWhatsApp()">POST REPORT</button>
        </div>

        <div class="row g-2 mb-2">
            <div class="col-4">
                <select id="period-sel" class="form-select form-select-sm fw-bold" onchange="syncClassInfo()">
                    <option value="0">P-I (9:20)</option>
                    <option value="1">P-II (10:10)</option>
                    <option value="2">P-III (11:10)</option>
                    <option value="3">P-IV (12:00)</option>
                    <option value="4">P-V (1:30)</option>
                    <option value="5">P-VI (2:20)</option>
                    <option value="6">P-VII (3:10)</option>
                </select>
            </div>
            <div class="col-8">
                <div id="class-info-display" class="form-control form-control-sm bg-light fw-bold text-truncate" style="font-size: 0.75rem;">Loading...</div>
            </div>
        </div>

        <div class="d-flex gap-2 mb-2">
            <div class="stats-badge bg-white border text-dark">Total: 32</div>
            <div class="stats-badge bg-success text-white">P: <span id="p-count">32</span></div>
            <div class="stats-badge bg-danger text-white">A: <span id="a-count">0</span></div>
            <button class="btn btn-sm btn-outline-secondary" onclick="resetAll()">Clear</button>
        </div>

        <input type="text" id="prev-list-input" class="form-control form-control-sm mb-1" placeholder="Paste prev absentees to compare..." oninput="calculateDiff()">
        <div id="diff-box" class="diff-box"></div>
    </div>
</div>

<div class="container mt-3 pb-5">
    <div id="student-list"></div>
</div>

<script>
    // Data from image_8777cd.png and image_7c292d.png
    const students = [
        { r: "23E11A0201", n: "BASIUDEM ARJUN REDDY", g: "B" },
        { r: "23E11A0202", n: "K RAJKUMAR", g: "B" },
        { r: "23E11A0204", n: "KUTHATI DHANYA", g: "B" },
        { r: "23E11A0205", n: "PANTAHNGI NAVYA", g: "G" },
        { r: "23E11A0207", n: "KUNTIGORLA RAKESH", g: "B" },
        { r: "24E15A0201", n: "A VAISHNAVI", g: "G" },
        { r: "24E15A0202", n: "A.RAKESH VERMA", g: "B" },
        { r: "24E15A0203", n: "ALIVELI KARTHIK KUMAR", g: "B" },
        { r: "24E15A0204", n: "B.HARSHITHA", g: "G" },
        { r: "24E15A0205", n: "BODRAMANI SAI KIRAN", g: "B" },
        { r: "24E15A0206", n: "D BHARATHCHANDRA", g: "B" },
        { r: "24E15A0207", n: "D.SHAILAJA", g: "G" },
        { r: "24E15A0208", n: "DEVASATH RISHI KUMAR", g: "B" },
        { r: "24E15A0209", n: "G.SAI KUMAR", g: "B" },
        { r: "24E15A0210", n: "GUGULOTHU SAI KUMAR", g: "B" },
        { r: "24E15A0212", n: "KONDURU NITHIN", g: "B" },
        { r: "24E15A0213", n: "M BHASKAR", g: "B" },
        { r: "24E15A0214", n: "M GANESH", g: "B" },
        { r: "24E15A0215", n: "M.GOWTHAMI", g: "G" },
        { r: "24E15A0216", n: "MANDRA SHIVAMANI", g: "B" },
        { r: "24E15A0217", n: "MARAM AJAY", g: "B" },
        { r: "24E15A0218", n: "N MUKESH", g: "B" },
        { r: "24E15A0219", n: "O.GAMANA", g: "G" },
        { r: "24E15A0220", n: "P.VARSHA", g: "G" },
        { r: "24E15A0221", n: "R SPROOTHIKA", g: "G" },
        { r: "24E15A0222", n: "RAMAVATH SAIRAM", g: "B" },
        { r: "24E15A0223", n: "RATHOD SHRUTHI", g: "G" },
        { r: "24E15A0224", n: "SNEHA TAANK", g: "G" },
        { r: "24E15A0225", n: "THUMMALA SAI KUMAR", g: "B" },
        { r: "24E15A0226", n: "VADLA SAI KRISHNA", g: "B" },
        { r: "24E15A0227", n: "VALLAPU KARTHIK YADAV", g: "B" },
        { r: "24E15A0228", n: "V CHAKRAVARTHI VARMA", g: "B" }
    ];

    // From image_8712e6.png
    const facultyMap = {
        'FIOT': 'Mr. Praburaja Ramasamy',
        'WSES': 'Mr. G. Nagarjuna',
        'DSP': 'Mr. Muzammil Mushtaq',
        'PSP': 'Mrs. K Vani',
        'PSOC': 'Dr. Praveen Tiwari',
        'Power System Laboratory': 'Dr. Harsh Wardhan Pandey & Mr. Muzammil Mushtaq',
        'Control Systems Laboratory': 'Mr. Muzammil Mushtaq',
        'Digital Signal Processing Laboratory': 'Mr. Muzammil Mushtaq',
        'Industrial Oriented Mini Project/Internship': 'Dr. Harsh Wardhan Pandey',
        'ES': 'Mrs. D. Swathi Devi',
        'Communication skills training': 'Dr. Nandu Parvathy',
        'Aptitude': 'Training Cell', 'Bridge Class': 'Dept Coordinator', 'Remedial Class': 'Sub Faculty', 'HRT': 'Placement Cell', 'Gate Class': 'Gate Team'
    };

    // Timetable from image_7c306a.png
    const timetable = {
        'MON': ['WSES', 'DSP', 'PSP', 'PSOC', 'FIOT', 'Aptitude', 'Bridge Class'],
        'TUE': ['PSP', 'WSES', 'FIOT', 'DSP', 'Industrial Oriented Mini Project/Internship', 'Industrial Oriented Mini Project/Internship', 'Bridge Class'],
        'WED': ['FIOT', 'WSES', 'DSP', 'PSOC', 'Industrial Oriented Mini Project/Internship', 'Industrial Oriented Mini Project/Internship', 'Remedial Class'],
        'THU': ['PSOC', 'PSP', 'Control Systems Laboratory', 'Control Systems Laboratory', 'ES', 'HRT', 'Remedial Class'],
        'FRI': ['PSOC', 'DSP', 'Digital Signal Processing Laboratory', 'Digital Signal Processing Laboratory', 'ES', 'WSES', 'Remedial Class'],
        'SAT': ['FIOT', 'PSP', 'Power System Laboratory', 'Power System Laboratory', 'ES', 'Communication skills training', 'Gate Class']
    };

    let attendance = {}; // Stores roll: 'P' or 'A'

    function init() {
        const listDiv = document.getElementById('student-list');
        students.forEach(s => {
            attendance[s.r] = 'P'; // Initial state is Present
            const colorClass = s.g === 'B' ? 'boy-text' : 'girl-text';
            const div = document.createElement('div');
            div.className = 'roll-card marked-present';
            div.id = `card-${s.r}`;
            div.innerHTML = `
                <div class="${colorClass}">
                    <div class="fw-bold" style="font-size: 0.85rem;">${s.r}</div>
                    <div style="font-size: 0.75rem;">${s.n}</div>
                </div>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-success btn-attendance" onclick="mark('${s.r}','P')">P</button>
                    <button class="btn btn-outline-danger btn-attendance" onclick="mark('${s.r}','A')">A</button>
                </div>
            `;
            listDiv.appendChild(div);
        });
        syncClassInfo();
    }

    function mark(roll, status) {
        attendance[roll] = status;
        const card = document.getElementById(`card-${roll}`);
        const btns = card.querySelectorAll('button');
        card.classList.remove('marked-present', 'marked-absent');
        btns[0].className = 'btn btn-outline-success btn-attendance';
        btns[1].className = 'btn btn-outline-danger btn-attendance';

        if(status === 'P') {
            card.classList.add('marked-present');
            btns[0].className = 'btn btn-success btn-attendance';
        } else {
            card.classList.add('marked-absent');
            btns[1].className = 'btn btn-danger btn-attendance';
        }
        updateStats();
        calculateDiff();
    }

    function updateStats() {
        const abs = Object.values(attendance).filter(v => v === 'A').length;
        document.getElementById('a-count').innerText = abs;
        document.getElementById('p-count').innerText = 32 - abs; // Accurate Calculation
    }

    function syncClassInfo() {
        const d = ['SUN','MON','TUE','WED','THU','FRI','SAT'][new Date().getDay()];
        const p = document.getElementById('period-sel').value;
        const sub = (timetable[d]) ? timetable[d][p] : "Special Class";
        const fac = facultyMap[sub] || "Assigned Faculty";
        document.getElementById('class-info-display').innerText = `${sub} - ${fac}`;
        document.getElementById('current-day-display').innerText = `${d}, ${new Date().toLocaleDateString()}`;
    }

    function calculateDiff() {
        const input = document.getElementById('prev-list-input').value;
        const box = document.getElementById('diff-box');
        if(!input) { box.style.display = 'none'; return; }
        
        const prev = input.split(/[ ,]+/).filter(x => x.length > 5);
        const curr = Object.keys(attendance).filter(k => attendance[k] === 'A');
        
        const newlyAbsent = curr.filter(x => !prev.includes(x));
        const nowPresent = prev.filter(x => attendance[x] === 'P');

        box.style.display = 'block';
        box.innerHTML = `<b>Changes:</b><br>` + 
            (newlyAbsent.length ? `‚ùå New Absent: ${newlyAbsent.join(", ")}<br>` : "") +
            (nowPresent.length ? `‚úÖ Now Present: ${nowPresent.join(", ")}` : "");
    }

    function resetAll() {
        if(confirm("Reset all to Present?")) {
            Object.keys(attendance).forEach(r => mark(r, 'P'));
        }
    }

    function sendToWhatsApp() {
        const info = document.getElementById('class-info-display').innerText;
        const period = document.getElementById('period-sel').options[document.getElementById('period-sel').selectedIndex].text;
        const absList = Object.keys(attendance).filter(k => attendance[k] === 'A').sort().join(", ") || "NIL";
        
        const msg = `*üìä ATTENDANCE REPORT (G.NAGARJUNA_CLASS INCHARGE)*\n` +
                    `*Period:* ${period}\n` +
                    `*Class Info:* ${info}\n` +
                    `--------------------------\n` +
                    `*‚úÖ Total Present:* ${document.getElementById('p-count').innerText}\n` +
                    `*‚ùå Total Absent:* ${document.getElementById('a-count').innerText}\n` +
                    `--------------------------\n` +
                    `*Absentees Roll Nos:*\n${absList}\n` +
                    `--------------------------`;

        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    init();
</script>
</body>
</html>
