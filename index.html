<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Faculty Attendance App</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f0f2f5; -webkit-tap-highlight-color: transparent; }
        .sticky-header { position: sticky; top: 0; background: white; z-index: 1000; border-bottom: 4px solid #0d6efd; padding: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .roll-card { background: white; margin-bottom: 8px; border-radius: 12px; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ccc; transition: 0.2s; }
        .marked-present { border-left-color: #198754; background: #eefdf5; }
        .marked-absent { border-left-color: #dc3545; background: #fff5f5; }
        .stats-badge { font-size: 0.8rem; padding: 6px 12px; border-radius: 50px; font-weight: bold; }
        .btn-group .btn { width: 60px; font-weight: bold; border-radius: 20px !important; margin-left: 5px; }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="container p-0">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0 fw-bold text-primary">Attendance Portal</h5>
            <button class="btn btn-success btn-sm fw-bold px-3" onclick="sendToWhatsApp()">POST REPORT</button>
        </div>

        <div class="row g-2 mb-2">
            <div class="col-4">
                <label class="small fw-bold text-muted">Period</label>
                <select id="period-sel" class="form-select form-select-sm" onchange="updateClassInfo()">
                    <option value="0">I (9:20)</option>
                    <option value="1">II (10:10)</option>
                    <option value="2">III (11:10)</option>
                    <option value="3">IV (12:00)</option>
                    <option value="4">V (1:30)</option>
                    <option value="5">VI (2:20)</option>
                    <option value="6">VII (3:10)</option>
                </select>
            </div>
            <div class="col-8">
                <label class="small fw-bold text-muted">Subject & Faculty</label>
                <div id="display-info" class="form-control form-control-sm bg-light fw-bold text-truncate">Loading...</div>
            </div>
        </div>

        <div class="d-flex gap-2 justify-content-between">
            <div class="stats-badge bg-primary text-white text-center flex-fill">TOTAL: 32</div>
            <div class="stats-badge bg-success text-white text-center flex-fill">PRESENT: <span id="p-count">0</span></div>
            <div class="stats-badge bg-danger text-white text-center flex-fill">ABSENT: <span id="a-count">0</span></div>
            <button class="btn btn-outline-secondary btn-sm" onclick="resetAll()">Reset</button>
        </div>
    </div>
</div>

<div class="container mt-3 pb-5">
    <div id="roll-list"></div>
</div>

<script>
    // List from image_7c292d.png
    const rollNumbers = [
        "23E11A0201", "23E11A0202", "23E11A0204", "23E11A0205", "23E11A0207",
        "24E15A0201", "24E15A0202", "24E15A0203", "24E15A0204", "24E15A0205",
        "24E15A0206", "24E15A0207", "24E15A0208", "24E15A0209", "24E15A0210",
        "24E15A0212", "24E15A0213", "24E15A0214", "24E15A0215", "24E15A0216",
        "24E15A0217", "24E15A0218", "24E15A0219", "24E15A0220", "24E15A0221",
        "24E15A0222", "24E15A0223", "24E15A0224", "24E15A0225", "24E15A0226",
        "24E15A0227", "24E15A0228"
    ];

    // Data from image_8712e6.png (Table + Timetable)
    const facultyData = {
        'FIOT': 'Mr. Praburaja Ramasamy',
        'WSES': 'Mr. G. Nagarjuna',
        'DSP': 'Mr. Muzammil Mushtaq',
        'PSP': 'Mrs. K Vani',
        'PSOC': 'Dr. Praveen Tiwari',
        'Power System Laboratory': 'Dr. Harsh Wardhan Pandey & Mr. Muzammil Mushtaq',
        'Control Systems Laboratory': 'Mr. Muzammil Mushtaq',
        'Digital Signal Processing Laboratory': 'Mr. Muzammil Mushtaq',
        'Industrial Oriented Mini Project/Internship': 'Dr. Harsh Wardhan Pandey',
        'ES': 'Mrs. D. Swathi Devi',
        'Communication skills training': 'Dr. Nandu Parvathy',
        'Aptitude': 'Training Cell',
        'Bridge Class': 'Department Coordinator',
        'Remedial Class': 'Subject Faculty',
        'HRT': 'Placement Cell',
        'Gate Class': 'Gate Team'
    };

    const schedule = {
        'MON': ['WSES', 'DSP', 'PSP', 'PSOC', 'FIOT', 'Aptitude', 'Bridge Class'],
        'TUE': ['PSP', 'WSES', 'FIOT', 'DSP', 'Industrial Oriented Mini Project/Internship', 'Industrial Oriented Mini Project/Internship', 'Bridge Class'],
        'WED': ['FIOT', 'WSES', 'DSP', 'PSOC', 'Industrial Oriented Mini Project/Internship', 'Industrial Oriented Mini Project/Internship', 'Remedial Class'],
        'THU': ['PSOC', 'PSP', 'Control Systems Laboratory', 'Control Systems Laboratory', 'ES', 'HRT', 'Remedial Class'],
        'FRI': ['PSOC', 'DSP', 'Digital Signal Processing Laboratory', 'Digital Signal Processing Laboratory', 'ES', 'WSES', 'Remedial Class'],
        'SAT': ['FIOT', 'PSP', 'Power System Laboratory', 'Power System Laboratory', 'ES', 'Communication skills training', 'Gate Class']
    };

    let attendance = {};

    function init() {
        const listDiv = document.getElementById('roll-list');
        rollNumbers.forEach(roll => {
            const div = document.createElement('div');
            div.className = 'roll-card shadow-sm';
            div.id = `card-${roll}`;
            div.innerHTML = `
                <span class="fw-bold text-dark">${roll}</span>
                <div class="btn-group">
                    <button class="btn btn-outline-success" onclick="mark('${roll}','P')">P</button>
                    <button class="btn btn-outline-danger" onclick="mark('${roll}','A')">A</button>
                </div>
            `;
            listDiv.appendChild(div);
        });
        updateClassInfo();
    }

    function updateClassInfo() {
        const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
        const day = days[new Date().getDay()];
        const idx = document.getElementById('period-sel').value;
        const sub = (schedule[day]) ? schedule[day][idx] : "No Class";
        const fac = facultyData[sub] || "Assigned Faculty";
        document.getElementById('display-info').innerText = `${sub} - ${fac}`;
    }

    function mark(roll, status) {
        attendance[roll] = status;
        const card = document.getElementById(`card-${roll}`);
        const buttons = card.querySelectorAll('button');
        
        card.classList.remove('marked-present', 'marked-absent');
        buttons[0].className = 'btn btn-outline-success';
        buttons[1].className = 'btn btn-outline-danger';

        if(status === 'P') {
            card.classList.add('marked-present');
            buttons[0].className = 'btn btn-success shadow-sm';
        } else {
            card.classList.add('marked-absent');
            buttons[1].className = 'btn btn-danger shadow-sm';
        }
        updateStats();
    }

    function updateStats() {
        const values = Object.values(attendance);
        const aCount = values.filter(v => v === 'A').length;
        const pCount = values.filter(v => v === 'P').length;
        
        document.getElementById('a-count').innerText = aCount;
        document.getElementById('p-count').innerText = pCount;
    }

    function resetAll() {
        if(confirm("Start new attendance?")) {
            attendance = {};
            document.querySelectorAll('.roll-card').forEach(c => c.className = 'roll-card shadow-sm');
            document.querySelectorAll('.btn-group button').forEach(b => {
                b.className = b.innerText === 'P' ? 'btn btn-outline-success' : 'btn btn-outline-danger';
            });
            updateStats();
        }
    }

    function sendToWhatsApp() {
        const info = document.getElementById('display-info').innerText;
        const period = document.getElementById('period-sel').options[document.getElementById('period-sel').selectedIndex].text;
        const absList = Object.keys(attendance).filter(k => attendance[k] === 'A').sort().join(", ") || "NIL";
        const pCount = document.getElementById('p-count').innerText;
        const aCount = document.getElementById('a-count').innerText;

        const message = `*üìä ATTENDANCE REPORT(G.NAGARJUNA_CLASS INCHARGE)*\n` +
                        `*Period:* ${period}\n` +
                        `*Class Info:* ${info}\n` +
                        `--------------------------\n` +
                        `*‚úÖ Total Present:* ${pCount}\n` +
                        `*‚ùå Total Absent:* ${aCount}\n` +
                        `--------------------------\n` +
                        `*Absentees Roll Nos:*\n${absList}\n` +
                        `--------------------------`;

        window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
    }

    init();
</script>
</body>
</html>
