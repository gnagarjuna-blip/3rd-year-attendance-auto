<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Attendance Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .sticky-header { position: sticky; top: 0; background: #ffffff; z-index: 1000; border-bottom: 4px solid #1a73e8; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-absent { width: 85px; font-weight: 600; border-radius: 20px; transition: 0.2s; }
        .is-absent { background-color: #d93025 !important; color: white !important; border-color: #d93025; }
        .stats-card { background: #e8f0fe; border-radius: 10px; padding: 10px; margin-bottom: 10px; font-size: 0.9rem; }
        .diff-area { background: #fff4e5; border: 1px dashed #ff9800; border-radius: 8px; padding: 10px; margin-bottom: 10px; display: none; }
        .roll-row { background: white; margin-bottom: 5px; border-radius: 8px; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ccc; }
        .roll-row.marked { border-left-color: #d93025; background: #fce8e6; }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="container p-0">
        <h5 class="text-primary fw-bold mb-2">Attendance Portal</h5>
        
        <div class="row g-2 mb-2">
            <div class="col-6">
                <label class="small fw-bold">Select Period & Time</label>
                <select id="period-select" class="form-select form-select-sm" onchange="loadClassDetails()">
                    <option value="0">P-I (9:20-10:10)</option>
                    <option value="1">P-II (10:10-11:00)</option>
                    <option value="2">P-III (11:10-12:00)</option>
                    <option value="3">P-IV (12:00-12:50)</option>
                    <option value="4">P-V (01:30-02:20)</option>
                    <option value="5">P-VI (02:20-03:10)</option>
                    <option value="6">P-VII (03:10-04:00)</option>
                </select>
            </div>
            <div class="col-6">
                <label class="small fw-bold">Faculty Name</label>
                <input type="text" id="faculty-name" class="form-control form-control-sm" placeholder="Your Name">
            </div>
        </div>

        <div class="row g-2 mb-3">
            <div class="col-12">
                <div class="input-group input-group-sm">
                    <span class="input-group-text bg-light fw-bold">Subject</span>
                    <input type="text" id="subject-display" class="form-control bg-white">
                </div>
            </div>
        </div>

        <div class="accordion mb-2" id="comparisonAcc">
            <div class="accordion-item border-0">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed p-2 small bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDiff">
                        Compare with Previous Hour?
                    </button>
                </h2>
                <div id="collapseDiff" class="accordion-collapse collapse" data-bs-parent="#comparisonAcc">
                    <div class="accordion-body p-2">
                        <small class="text-muted">Paste previous roll numbers (comma separated):</small>
                        <textarea id="prev-data-input" class="form-control form-control-sm mt-1" rows="2" placeholder="e.g. 24E15A0201, 24E15A0205" oninput="compareData()"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div id="diff-output" class="diff-area small"></div>

        <div class="stats-card d-flex justify-content-around text-center fw-bold">
            <div class="text-secondary">Total<br><span id="total-cnt">32</span></div>
            <div class="text-success">Present<br><span id="pres-cnt">32</span></div>
            <div class="text-danger">Absent<br><span id="abs-cnt">0</span></div>
        </div>

        <button class="btn btn-success w-100 fw-bold shadow-sm mt-1" onclick="sendWhatsApp()">POST TO WHATSAPP GROUP</button>
    </div>
</div>

<div class="container mt-3 pb-5">
    <div id="roll-container">
        </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const rollNumbers = [
        "23E11A0201", "23E11A0202", "23E11A0204", "23E11A0205", "23E11A0207",
        "24E15A0201", "24E15A0202", "24E15A0203", "24E15A0204", "24E15A0205",
        "24E15A0206", "24E15A0207", "24E15A0208", "24E15A0209", "24E15A0210",
        "24E15A0212", "24E15A0213", "24E15A0214", "24E15A0215", "24E15A0216",
        "24E15A0217", "24E15A0218", "24E15A0219", "24E15A0220", "24E15A0221",
        "24E15A0222", "24E15A0223", "24E15A0224", "24E15A0225", "24E15A0226",
        "24E15A0227", "24E15A0228"
    ];

    const timetable = {
        'MON': ['WSES', 'DSP', 'PSP', 'PSOC', 'FIOT', 'Aptitude', 'Bridge Class'],
        'TUE': ['PSP', 'WSES', 'FIOT', 'DSP', 'Mini Project', 'Mini Project', 'Bridge Class'],
        'WED': ['FIOT', 'WSES', 'DSP', 'PSOC', 'Mini Project', 'Mini Project', 'Remedial Class'],
        'THU': ['PSOC', 'PSP', 'CS Lab', 'CS Lab', 'ES', 'HRT', 'Remedial Class'],
        'FRI': ['PSOC', 'DSP', 'DSP Lab', 'DSP Lab', 'ES', 'WSES', 'Remedial Class'],
        'SAT': ['FIOT', 'PSP', 'PS Lab', 'PS Lab', 'ES', 'Comm Skills', 'Gate Class']
    };

    let absentees = new Set();

    function init() {
        const container = document.getElementById('roll-container');
        rollNumbers.forEach(roll => {
            const div = document.createElement('div');
            div.className = 'roll-row shadow-sm';
            div.id = `row-${roll}`;
            div.innerHTML = `
                <span class="fw-bold text-dark">${roll}</span>
                <button class="btn btn-outline-danger btn-sm btn-absent" onclick="mark('${roll}')">ABSENT</button>
            `;
            container.appendChild(div);
        });
        loadClassDetails();
    }

    function loadClassDetails() {
        const days = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
        const day = days[new Date().getDay()];
        const idx = document.getElementById('period-select').value;
        const sub = (timetable[day]) ? timetable[day][idx] : "Special Class";
        document.getElementById('subject-display').value = sub;
    }

    function mark(roll) {
        const btn = document.querySelector(`#row-${roll} button`);
        const row = document.getElementById(`row-${roll}`);
        if (absentees.has(roll)) {
            absentees.delete(roll);
            btn.classList.remove('is-absent');
            btn.innerText = "ABSENT";
            row.classList.remove('marked');
        } else {
            absentees.add(roll);
            btn.classList.add('is-absent');
            btn.innerText = "MARKED";
            row.classList.add('marked');
        }
        updateStats();
        compareData();
    }

    function updateStats() {
        document.getElementById('total-cnt').innerText = rollNumbers.length;
        document.getElementById('abs-cnt').innerText = absentees.size;
        document.getElementById('pres-cnt').innerText = rollNumbers.length - absentees.size;
    }

    function compareData() {
        const input = document.getElementById('prev-data-input').value;
        const output = document.getElementById('diff-output');
        if(!input) { output.style.display = "none"; return; }

        const prevList = input.split(/[ ,]+/).filter(x => x.trim().length > 0);
        const currentList = [...absentees];

        const newlyAbsent = currentList.filter(x => !prevList.includes(x));
        const nowPresent = prevList.filter(x => !currentList.includes(x));

        output.style.display = "block";
        output.innerHTML = `<strong>Hourly Changes:</strong><br>` +
            (newlyAbsent.length ? `‚ùå New Absentees: ${newlyAbsent.join(", ")}<br>` : "") +
            (nowPresent.length ? `‚úÖ Now Present: ${nowPresent.join(", ")}` : "");
        
        if(!newlyAbsent.length && !nowPresent.length) output.innerHTML = "‚úÖ No changes from previous hour.";
    }

    function sendWhatsApp() {
        const pIdx = document.getElementById('period-select').value;
        const pLabel = document.getElementById('period-select').options[pIdx].text;
        const sub = document.getElementById('subject-display').value;
        const fac = document.getElementById('faculty-name').value || "Class Faculty";
        const date = new Date().toLocaleDateString();
        
        const absStr = absentees.size > 0 ? [...absentees].sort().join(", ") : "NIL";

        const msg = `*üì¢ ATTENDANCE REPORT*\n` +
                    `*üìÖ Date:* ${date}\n` +
                    `*‚è∞ Period:* ${pLabel}\n` +
                    `*üìö Subject:* ${sub}\n` +
                    `*üë®‚Äçüè´ Faculty:* ${fac}\n` +
                    `--------------------------\n` +
                    `*‚úÖ Present:* ${rollNumbers.length - absentees.size}\n` +
                    `*‚ùå Absentees:* ${absentees.size}\n` +
                    `--------------------------\n` +
                    `*Roll Nos (Absentees):*\n${absStr}\n` +
                    `--------------------------`;

        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    init();
</script>
</body>
</html>
